<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Stacked branches and the new world - Mere Code</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    <!-- Open Graph tags -->
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Stacked branches and the new world"/>
            <meta property="og:url" content="http://code.mumak.net/2008/12/stacked-branches-and-new-world.html"/>
            <meta property="og:description" content="A few months ago, we rolled out a version of Launchpad that supports and encourages stacked branches. This means medium to large size projects are be able to use Launchpad for hosting their code. I wrote this post shortly before the roll-out, but never got around to blogging it. Hope ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://code.mumak.net/theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="http://code.mumak.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://code.mumak.net/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://code.mumak.net/theme/css/style.css" type="text/css"/>

        <link href="http://code.mumak.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Mere Code ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://code.mumak.net/" class="navbar-brand">
Mere Code            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://code.mumak.net/blog/archives/"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://code.mumak.net/2008/12/stacked-branches-and-new-world.html"
                       rel="bookmark"
                       title="Permalink to Stacked branches and the new world">
                        Stacked branches and the new world
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2008-12-15T06:54:00"> Mon 15 December 2008</time>
    </span>



    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>A few months ago, we rolled out a version of Launchpad that supports and
encourages <span>stacked branches</span>. This means medium to large
size projects are be able to use Launchpad for hosting their code. I
wrote this post shortly before the roll-out, but never got around to
blogging it. Hope you enjoy it.  </p>
<p><span>The Problem</span><br />
As far as code goes, Launchpad thinks in terms of individual Bazaar
branches. Each of these Bazaar branches stands alone, isolated from
other branches. Further, each of these branches has the full history of
whatever project they are a branch of.  </p>
<p>That means that every time you push a branch up to Launchpad, you have
to push the <span>entire history</span> of your project. That's not a
problem for small projects, but for large projects it's simply
unacceptable. It takes well over an hour for me to push up a branch of
Bazaar, for example.  </p>
<p>On our side, we simply don't have the space to store hundreds of copies
of the full history of every Free Software project in the world.  </p>
<p><span>The Shape of the Solution</span><br />
The answer to both of these problems is to share history information
between branches. That way, when you push a new branch, you would only
have to push up the data that's unique to that branch, the changes that
you've made locally. Similarly, we'd only need to store those changes,
rather than another full copy of the history.  </p>
<p><span>Shared Repositories?</span><br />
Experienced users of Bazaar might be wondering why we didn't just use
shared repositories. A repository is like a big bucket full of Bazaar
revisions. A repository can be made a shared repository, and branches
can be made to get their revisions from <span>that</span> repository,
rather than from their own. This works fine in many circumstances, but
for a public service like Launchpad, it's not good enough.  </p>
<p>First, people can put poison the bucket. If you can push up a branch,
you can write to the shared repository. If you can write to a shared
repository at all, then you can write to <span>any</span> revision in
that shared repository. This means malicious users could poison any
repository that they can push to. If we had a shared repository per
project, then malicious users could push up branches that change a
project's history.  </p>
<p>A shared repository per person, per project is not so bad, but it's not
so good either. In that model, users would have to push up the full
history of a project the first time they contributed a project.
<span>Blech.</span> The last thing we want to do is penalize someone for
contributing to a new project. Launchpad is supposed to make it easy for
you to get started.  </p>
<p><span>Stacked Branches</span><br />
A stacked branch is a branch that only has a little bit of its own
history. The rest of its history lives in another branch, what we call
the <span>stacked-on branch</span> (I don't like the name, but all the
better ones are taken). The Bazaar team has been working on making
Bazaar support stacked branches for much of this year.  </p>
<p>Stacked branches are exactly what Launchpad needs to get you pushing
your branches up quickly. When you push up a stacked branch, you only
need write access to the repository of <span>that branch</span>, you
only need to read the stacked-on branch. This eliminates the poisoning
problem, and allows revisions to be shared safely between branches.  </p>
<p><span>How We Do It<span><span></span></span></span><br />
For each project with a development focus (Launchpad's jargon for an
official trunk), Launchpad has a policy file that tells Bazaar that new
branches should be stacked on that development focus.  </p>
<p>So, you make a branch from trunk, do a bit of hacking locally, commit a
few revisions and push it up to Launchpad as your own branch, say
lp:\~jml/tribunal/awesome-new-feature. When you push, Bazaar asks
Launchpad where it should stack the branch, and Launchpad says
lp:\~jml/tribunal/trunk. Bazaar then pushes only the new revisions I've
added to my "awesome-new-feature" branch.  </p>
<p>We do a lot of stuff behind the scenes to make sure the branches work
over HTTP, bzr+ssh, SFTP and to make sure that mirrored branches work
just as well as hosted branches and so on. I hope that most of this is
invisible to you, and that you simply notice that pushing big branches
to Launchpad suddenly got a lot faster.  </p>
<p><span>The Future</span><br />
By making it possible to quickly push big branches to Launchpad, we've
entered a new era. Projects like Bazaar and Launchpad itself can start
actually hosting their branches on Launchpad. For other projects (like
Twisted, Python or even GNOME), hosting branches on Launchpad is now an
option that can be seriously considered.  </p>
<p>For my part, stacked branches are already changing the way I work. I'm
now using the product that I helped build each and every day as part of
my job. Further, my colleagues and my boss are also using it. This
quickly exposes rough edges and raises obvious ideas for improvement in
the rest of the Code site. It also helps me see which bugs are the
really important ones.  </p>
<p>More importantly, it's reminded me that Launchpad actually is pretty
cool. I'm using it more, and looking forward to the day when I can
really, genuinely say that Launchpad is a joy to use.</p>
            </div>
            <!-- /.entry-content -->

    <hr />
    <section class="comments">
      <h2>Comments</h2>

            <article id="comment-3202883889297233838.md">
                <a href="http://code.mumak.net/2008/12/stacked-branches-and-new-world.html#comment-3202883889297233838.md" rel="bookmark" title="Permalink to this comment">Permalink</a>
                <h4>Eduardo de Oliveira Padoan (noreply@blogger.com)</h4>
                <p>Posted on <abbr class="published" title="2008-12-15T16:00:00">Mon 15 December 2008</abbr></p>
                
                <p>Thanks for this post, Its exactly the kinfd of thing I like to read at
Planet Bazaar.</p>
            </article>
    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">



                <li class="list-group-item"><a href="http://code.mumak.net/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group" id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://code.mumak.net/tag/uncategorized.html">
                                Uncategorized
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://code.mumak.net/tag/hacking.html">
                                Hacking
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://code.mumak.net/tag/testtools.html">
                                testtools
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://code.mumak.net/tag/launchpad.html">
                                launchpad
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://code.mumak.net/tag/bazaar.html">
                                Bazaar
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="http://code.mumak.net/tag/testing.html">
                                Testing
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/twisted.html">
                                Twisted
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/subunit-data.html">
                                subunit data
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/launchpad-subunit-data.html">
                                launchpad subunit data
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/personal.html">
                                Personal
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/blog.html">
                                blog
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/ui.html">
                                UI
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/pelican.html">
                                pelican
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://code.mumak.net/tag/ubuntu.html">
                                ubuntu
                            </a>
                        </li>
                    </ul>
                </li>    

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Jonathan M. Lange
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="//code.jquery.com/jquery.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://code.mumak.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://code.mumak.net/theme/js/respond.min.js"></script>

</body>
</html>